{
  "meta": {
    "project": "UI Dataset Builder",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "A CLI tool that crawls web pages with Playwright, captures screenshots, extracts UI element bounding boxes and metadata, and exports labeled datasets (COCO and optionally YOLO) plus visualizations for VLM grounding.",
  "core_goals": [
    "Crawl a list of target URLs and render each page in Chromium to produce high-fidelity screenshots",
    "Automatically extract UI element bounding boxes and rich per-element metadata from the DOM for dataset labeling",
    "Export annotations in COCO format and optionally YOLO, and produce per-image metadata and a manifest for downstream workflows",
    "Provide configurable crawling and export options (viewport, concurrency, scroll steps, load strategy, classes, size filters)",
    "Support reproducible development workflows with visualization tooling and clear failure logs",
    "Encourage responsible usage by exposing robots.txt respect and surfacing legal guidance"
  ],
  "features": [
    {
      "name": "Install & Setup",
      "description": "Install project dependencies and browser binaries required to run the dataset builder.",
      "user_flows": [
        "Clone repository to local machine -> Run uv sync -> Dependencies install completes successfully -> Run playwright install chromium -> Chromium binary installed -> See success message indicating environment ready",
        "Clone repository to local machine -> Run uv sync -> Dependency resolution fails with error -> See error message listing missing system packages and suggested fixes"
      ]
    },
    {
      "name": "Run Build (Crawl + Annotate)",
      "description": "Crawl URLs, render pages, take screenshots, extract DOM element bounding boxes and metadata, and write dataset outputs.",
      "user_flows": [
        "Prepare urls file with one URL per line at data/urls.txt -> Run uv run ui-dataset build --urls-file data/urls.txt --out output/ --max-pages 10 -> Tool reads urls file -> Launch Chromium browser contexts with configured concurrency -> For each URL navigate to the page -> Wait for networkidle (or configured load strategy) -> Take screenshot and save to output/images/<site>/<page_id>.png -> Extract DOM elements and bounding boxes -> Append annotation entry to output/annotations/coco.json -> Write per-image metadata to output/metadata/<site>/<page_id>.json -> Append line to output/manifest.jsonl for the page -> After processing, write failures to output/logs/failures.csv if any -> See completion summary and output folder populated",
        "Run uv run ui-dataset build without --urls-file -> CLI attempts to read default data/urls.txt -> Default urls file missing -> CLI prints error 'urls file not found' and exits without creating outputs"
      ]
    },
    {
      "name": "Configure Crawl Options",
      "description": "Adjust crawl behavior and capture settings via CLI flags to control viewport, scrolling, concurrency, page load strategy, and element filters.",
      "user_flows": [
        "Run uv run ui-dataset build --urls-file data/urls.txt --out output/ --viewport \"1280x720\" --concurrency 4 --scroll-steps 2 --wait networkidle -> Builder applies viewport and concurrency settings -> Pages are crawled with two extra scroll screenshots per page -> Outputs reflect configured settings",
        "Run uv run ui-dataset build with invalid --viewport value 'abc' -> CLI validates flags -> CLI prints validation error 'invalid viewport format' and exits without running"
      ]
    },
    {
      "name": "Export Formats & Class Taxonomy",
      "description": "Export annotations as COCO and/or YOLO and control which UI classes are included in exports.",
      "user_flows": [
        "Run uv run ui-dataset build --urls-file data/urls.txt --out output/ --export both --classes button,link,input,checkbox,image_icon -> Builder exports COCO to output/annotations/coco.json and YOLO .txt files to output/annotations/yolo/ -> See both formats present in output",
        "Run uv run ui-dataset build --export unknownformat -> CLI validates export option -> CLI prints error 'unsupported export format' and exits"
      ]
    },
    {
      "name": "Visualize Annotations",
      "description": "Render bounding boxes on example images to visually validate annotations using the included visualization script.",
      "user_flows": [
        "Install Pillow via uv sync --extra dev -> Run python scripts/visualize_coco.py --max-images 5 -> Script loads output/annotations/coco.json and images from output/images/ -> Script writes visualization images to output/annotations/visualized/ -> Open visualized images and see bounding boxes overlaid",
        "Run python scripts/visualize_coco.py without Pillow installed -> Script attempts to import Pillow -> Script raises ImportError -> See message instructing to install dependencies (uv sync --extra dev) and abort"
      ]
    },
    {
      "name": "Failure Logging & Debugging",
      "description": "Record failed URL visits and errors to a CSV for debugging and provide per-image per-page JSON for inspection.",
      "user_flows": [
        "Run a build where some pages fail to load due to timeouts -> Builder records failures with URL and error in output/logs/failures.csv -> Open failures.csv to inspect error messages and page IDs -> Use per-image JSON in output/annotations/per_image/<page_id>.json to debug DOM extraction for failing pages",
        "Run build where output directory is not writable -> Builder attempts to write files -> Filesystem permission error occurs -> CLI prints 'permission denied' error and aborts the run without partial outputs"
      ]
    },
    {
      "name": "Legal / Robots Respect",
      "description": "Provide an option to respect robots.txt and surface legal guidance; default behavior is not to respect robots.txt but warn the user.",
      "user_flows": [
        "Run uv run ui-dataset build --urls-file data/urls.txt --respect-robots -> Builder fetches robots.txt for each host -> Builder skips disallowed paths and logs skipped entries -> See log entries indicating which URLs were skipped due to robots rules",
        "Run uv run ui-dataset build without --respect-robots -> Builder proceeds without checking robots.txt -> CLI prints a warning 'respect-robots is false by default; ensure you have permission to crawl target sites' -> Continue with crawl"
      ]
    },
    {
      "name": "Dataset Manifest & Per-Image Metadata",
      "description": "Produce a manifest.jsonl line per sample and detailed per-image metadata useful for VLM grounding and downstream labeling.",
      "user_flows": [
        "Run a successful build -> Builder writes output/manifest.jsonl with entries (url, image_path, metadata_path, page_id) -> Builder writes per-image metadata to output/metadata/<site>/<page_id>.json -> Open manifest.jsonl and confirm each line references a valid image and metadata file",
        "Run build with malformed URL entry in data/urls.txt -> Builder attempts to process the URL -> Fetch fails or redirects unexpectedly -> Builder records the failure in output/logs/failures.csv and does not add a manifest line for that page"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      {
        "language": "TypeScript"
      },
      {
        "framework": "Next.js 14"
      },
      {
        "ui_library": "Radix UI, Tailwind CSS, Recharts, Framer Motion"
      },
      {
        "other": "TanStack React Query, dnd-kit, Monaco Editor"
      }
    ],
    "routes": [
      {
        "path": "/",
        "file": "src/app/page.tsx",
        "auth_required": false,
        "description": "Landing page with hero, how-it-works section, and CTA"
      },
      {
        "path": "/login",
        "file": "src/app/login/page.tsx",
        "auth_required": false,
        "description": "User login with email and password"
      },
      {
        "path": "/signup",
        "file": "src/app/signup/page.tsx",
        "auth_required": false,
        "description": "User signup with email, password, confirm password, and role selection"
      },
      {
        "path": "/home",
        "file": "src/app/home/page.tsx",
        "auth_required": true,
        "description": "Dashboard home overview showing service health and active incidents"
      },
      {
        "path": "/incidents",
        "file": "src/app/incidents/page.tsx",
        "auth_required": true,
        "description": "List of all incidents with severity badges and timestamps"
      },
      {
        "path": "/incidents/[id]",
        "file": "src/app/incidents/[id]/page.tsx",
        "auth_required": true,
        "description": "Incident detail room with tabs for Overview, Evidence, Forecast, Guided Steps, Recommendations, Tests, Memory"
      }
    ],
    "features": [
      {
        "name": "User Login",
        "description": "Sign in with email and password, redirects to /home on success",
        "files": [
          "src/app/login/page.tsx",
          "src/lib/auth.ts"
        ],
        "entry_route": "/login",
        "user_interactions": [
          "Fill email input field",
          "Fill password input field",
          "Click Sign In button",
          "See error message on invalid credentials",
          "Get redirected to /home on success"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/auth/login"
          }
        ],
        "auth_required": false
      },
      {
        "name": "User Signup",
        "description": "Create account with email, password, confirm password, and role (SRE, Backend, ML, Product)",
        "files": [
          "src/app/signup/page.tsx",
          "src/lib/auth.ts"
        ],
        "entry_route": "/signup",
        "user_interactions": [
          "Fill email input",
          "Fill password input (min 6 chars)",
          "Fill confirm password input",
          "Select role from SRE, Backend, ML, Product buttons",
          "Click Create Account button",
          "See error if passwords do not match or are too short",
          "Get redirected to /home on success"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/auth/signup"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Incidents List",
        "description": "View all incidents sorted by recency with severity and state labels",
        "files": [
          "src/app/incidents/page.tsx",
          "src/lib/api.ts"
        ],
        "entry_route": "/incidents",
        "user_interactions": [
          "View list of incident cards with title, services, timestamp, and severity badge",
          "Click on an incident card to navigate to the incident detail page",
          "See empty state message when no incidents exist"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/incidents"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Incident Investigation Room",
        "description": "Full incident investigation workspace with 7 tabs",
        "files": [
          "src/app/incidents/[id]/page.tsx",
          "src/components/IncidentRoom.tsx",
          "src/components/EvidenceView.tsx",
          "src/components/ForecastPanel.tsx",
          "src/components/interactive/GuidedSteps.tsx",
          "src/components/cards/RecommendationCard.tsx",
          "src/components/AgentTracePanel.tsx"
        ],
        "entry_route": "/incidents/[id]",
        "user_interactions": [
          "View incident header with title and severity badge",
          {
            "Switch between tabs": "Overview, Evidence, Forecast, Guided Steps, Recommendations, Tests, Memory"
          },
          "View telemetry evidence (metrics, logs, traces) in Evidence tab",
          "View Toto time-series forecast in Forecast tab",
          "Follow AI-generated guided investigation steps in Guided Steps tab",
          "View remediation recommendations in Recommendations tab",
          "View test results in Tests tab",
          "View agent trace / memory in Memory tab"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/incidents/{id}"
          },
          {
            "method": "GET",
            "endpoint": "/api/incidents/{id}/forecast"
          },
          {
            "method": "GET",
            "endpoint": "/api/incidents/{id}/agent-trace"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Home Dashboard",
        "description": "Overview of system health, active monitors, and recent incidents",
        "files": [
          "src/app/home/page.tsx",
          "src/components/HomeOverview.tsx"
        ],
        "entry_route": "/home",
        "user_interactions": [
          "View service health overview",
          "View active monitor alerts",
          "View recent incidents",
          "Auto-refresh every 30 seconds"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/home/overview"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "TestSprite integration in the Tests tab uses mock mode by default when no API key is set",
        "location": "src/app/integrations/testsprite.py",
        "impact": "Test results shown are deterministic mocks, not real test execution"
      },
      {
        "issue": "Incident investigation pipeline (6 LLM agents) can take 15-30s to complete",
        "location": "src/app/agentcore/runner.py",
        "impact": "Users may see loading states for extended periods on first visit"
      }
    ]
  }
}
